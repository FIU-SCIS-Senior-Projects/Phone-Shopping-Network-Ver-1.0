<!DOCTYPE html>
<head>
  <title>KnockoutJS Templating - foreach used with Template</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <style type="text/css">
    .wrap {
      background-color: #e1eef9;
    }

    .align-middle {
      margin: 0 auto;
    }

    .top_header {
      border-bottom: 2px solid navy;
      padding: 10px;
      margin-bottom: 20px;
    }

    ol.content {
      display: block;
      counter-reset: item;
      list-style: outside none none;
      padding-left: 0;
    }

    /*ol.content li::before {*/
    /*color: #2666ad;*/
    /*content: counter(item, decimal) "";*/
    /*counter-increment: item;*/
    /*}*/

    ol.content li {
      padding: 6px 12px;
    }

    ol.content li:nth-of-type(2n+1) {
      background-color: #d3e3f3;
    }

  </style>

  <!-- Latest compiled and minified JavaScript -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://ajax.aspnetcdn.com/ajax/knockout/knockout-3.3.0.js"
          type="text/javascript"></script>
</head>
<body>

<div class="container">
  <div class="wrap col-md-8">
    <div class="row align-middle">
      <div class="top_header"><h1>PhoneShopping Administration Console</h1></div>
    </div>

    <div class="row">
      <div id="inner_container">
        <!-- Nav tabs -->
        <ul id="tabs" class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#users" aria-controls="users" role="tab" data-toggle="tab">Users</a>
          </li>
          <li role="presentation"><a href="#products" aria-controls="products" role="tab" data-toggle="tab">Products</a>
          </li>
          <li role="presentation"><a href="#orders" aria-controls="orders" role="tab" data-toggle="tab">Orders</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="users">
            <ol class="content" data-bind="template: { name: 'users-template', foreach: users }"></ol>
          </div>

          <div role="tabpanel" class="tab-pane" id="products">
            <div class="product form">
              <div class="field-sets">
                <div>Product Title: <input type="text" name="title" data-bind="value: product.title"/></div>
                <div>Product Description: <input type="text" name="description" data-bind="value: product.description"/>
                </div>
                <div class="more-info">
                  <div class="wrapper">
                    <span class="left">Additional Info</span>

                  </div>
                  <ol data-bind="foreach: product.moreInfo">
                    <li class="info input" style="margin: 5px 0;">
                      <input type="text" name="name" class="name" style="float: left;" data-bind="value: name"/>
                      <input type="text" name="value" class="value" style="float:none; width: auto"
                             data-bind="value: value"/>
                      <button class="btn btn-primary" style="float: right" onclick="addInfo(this);">+</button>
                      <button class="btn btn-danger" style="float: right" onclick="removeInfo(this);">-</button>
                    </li>
                  </ol>
                </div>
              </div>
            </div>
            <!--<div data-bind="template: { name: 'products-template', foreach: products }"></div>-->
          </div>
          <div role="tabpanel" class="tab-pane" id="orders">
            <!--<div data-bind="template: { name: 'orders-template', foreach: orders }"></div>-->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="knockout_templates_users">
  <script type="text/html" id="users-template">
    <li class="elements">
      <details>
        <summary class="username column-header"><strong data-bind="text: username"></strong></summary>
        <div class="details">
          <div class="first-name">First name: <span data-bind="text: firstname"></span></div>
          <div class="last-name">Last name: <span data-bind="text: lastname"></span></div>
          <div class="email">Email: <span data-bind="text: email"></span></div>
          <div class="phone">Phone: <span data-bind="text: phone"></span></div>
        </div>
      </details>
    </li>
  </script>

  <script type="text/javascript">
    function NameValuePair(pName, pValue) {
      var self = this;
      self.name = ko.observable(pName);
      self.value = ko.observable(pValue);
    }

    function Product(pTitle, pDescription) {
      var self = this;
      self.title = ko.observable(pTitle);
      self.description = ko.observable(pDescription);
      self.moreInfo = ko.observableArray();
    }

    function addInfo(pElement) {
      var parentLi = $(pElement).parent();
      var index = parentLi.index();
      console.log("AddIno::: index: " + index);
      if (index != -1) {
        userVM.product.moreInfo.splice(index + 1, 0, new NameValuePair("name", "value"));
      }
      else {
        userVM.product.moreInfo.push(new NameValuePair("name", "value"));
      }
    }

    function removeInfo(pElement) {
      var parentLi = $(pElement).parent();
      var index = parentLi.index();
      console.log("RemoveIno::: index: " + index);
      if (index != -1) {
        userVM.product.moreInfo.splice(index, 1);
      }
      else {
        userVM.product.moreInfo.pop();
      }
    }

    function UsersViewModel() {
      var self = this;
      self.users = ko.observableArray();
      self.addUser = function (user) {
        self.users.push(user);
      };


      self.products = ko.observableArray();
      self.product = new Product("title", "description");
      self.product.moreInfo.push(new NameValuePair("name", "value"));
    }

    var userVM = new UsersViewModel();
    ko.applyBindings(userVM);

    var baseUrl = "http://psns:8080/phoneshopping-webapp/service";
    $.ajax({
      url: baseUrl + "/users"
    }).done(function (data) {
      $(data).each(function (index, user) {
        userVM.addUser(user);
        console.log("Data: " + user + "::  " + typeof(user));
      });
    })
  </script>
</div>

<div id="knockout_templates_products">

  <script type="text/html" id="products-template">
    <details>
      <summary class="username"><span data-bind="text: username"></span></summary>
      <div class="details">
        <div class="first-name"><span data-bind="text: firstName"></span></div>
        <div class="last-name"><span data-bind="text: lastName"></span></div>
        <div class="email"><span data-bind="text: email"></span></div>
        <div class="phone"><span data-bind="text: phone"></span></div>
      </div>
    </details>
  </script>

  <script type="text/javascript">

  </script>
</div>

<script type="text/javascript">
  $('#tabs a').click(function (e) {
    e.preventDefault();
    $(this).tab('show');
  });
</script>

<!--<h2>Friends List</h2>-->
<!--<div id="friends_form" class="form">-->
<!--<p>Title of the Product: <input type="text" name="title" data-bind="value: product_title" /></p>-->
<!--<p>Description of the Product: <input type="text" name="title" data-bind="value: product_desc" /></p>-->
<!--<button onclick="buttonClicked();return false;">Create</button>-->
<!--</div>-->
<!--Here are the Friends from your contact page:-->
<!--<div data-bind="template: { name: 'product-template', foreach: products }"></div>-->

<!--<script type="text/html" id="product-template">-->
<!--<details>-->
<!--<summary><span data-bind="text: title"></span></summary>-->
<!--<div><span data-bind="text: description"></span></div>-->
<!--</details>-->
<!--&lt;!&ndash;<h3 data-bind="text: name"></h3>&ndash;&gt;-->
<!--&lt;!&ndash;<p>Contact Number: <span data-bind="text: contactNumber"></span></p>&ndash;&gt;-->
<!--&lt;!&ndash;<p>Email-id: <span data-bind="text: email"></span></p>&ndash;&gt;-->
<!--</script>-->

<!--<script type="text/javascript">-->
<!--function buttonClicked() {-->
<!--var product = {-->
<!--title: vm.product_title,-->
<!--description: vm.product_desc-->
<!--};-->
<!--vm.addProduct(product);-->
<!--}-->

<!--function MyViewModel() {-->
<!--this.product_title = ko.observable(40);-->
<!--this.product_desc = ko.observable(50);-->

<!--products = ko.observableArray();-->
<!--this.addProduct = function (product){-->
<!--products.push(product);-->
<!--}-->
<!--}-->

<!--var vm = new MyViewModel();-->
<!--ko.applyBindings(vm);-->
<!--</script>-->
</body>
</html>